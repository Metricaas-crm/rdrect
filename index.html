<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirecionando...</title>
    <script>
        async function fetchAndRedirect() {
            try {
                // Endpoint do Xano
                const xanoEndpoint = "https://api.metricaas.com.br/api:0BoQA_U6/redirect";

                // Extrai os parâmetros da URL
                const params = new URLSearchParams(window.location.search);
                const userid = params.get("userid");
                const id = params.get("id");

                if (!userid || !id) {
                    throw new Error("Parâmetros 'userid' ou 'id' não encontrados na URL.");
                }

                // Monta o payload para enviar ao Xano
                const payload = { userid, id };

                // Faz a requisição ao Xano
                const response = await fetch(xanoEndpoint, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(payload)
                });

                // Verifica se a requisição foi bem-sucedida
                if (!response.ok) {
                    throw new Error(`Erro ao obter o link: ${response.statusText}`);
                }

                // Converte a resposta para JSON
                const data = await response.json();

                // Extrai o link do resultado (ajuste conforme a estrutura da resposta)
                const redirectUrl = data.link; // Exemplo: https://api.whatsapp.com/send?phone=...

                // Redireciona para o link
                if (redirectUrl) {
                    window.location.href = redirectUrl;
                } else {
                    throw new Error("Link não encontrado na resposta.");
                }
            } catch (error) {
                console.error("Erro durante o redirecionamento:", error);
                alert("Ocorreu um problema ao redirecionar. Por favor, tente novamente.");
            }
        }

        // Inicia o processo quando a página é carregada
        window.onload = fetchAndRedirect;
    </script>
</head>
<body>
    <h1>Redirecionando...</h1>
    <p>Por favor, aguarde enquanto processamos sua solicitação.</p>
</body>
</html>
